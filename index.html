<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat Gallery</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --accent-pink: #ffd6e0;
      --accent-violet: #e3d0ff;
      --muted: #6c757d;
      --banner-max-width: 576px;
    }

    @media (min-width: 576px) {
      :root {
        --banner-max-width: 700px;
      }
    }

    @media (min-width: 768px) {
      :root {
        --banner-max-width: 900px;
      }
    }

    @media (min-width: 992px) {
      :root {
        --banner-max-width: 1100px;
      }
    }

    body {
      background: linear-gradient(135deg, #fff0f6 0%, #ffd6e0 45%, #f3e9ff 100%);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      position: relative;
      z-index: 1;
    }

    .hero {
      background: rgba(255, 214, 224, 0.95);
      text-align: center;
      padding: 1rem;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(74, 43, 51, 0.06);
    }

    .hero h1 {
      margin: 0;
      font-size: 2rem;
      color: #4a2b33;
    }

    .hero .subtitle {
      margin-top: .4rem;
      color: #3b2b33;
    }

    #status {
      color: var(--muted);
      text-align: center;
      margin: .75rem 0;
    }

    .card-img-top {
      width: 100%;
      object-fit: cover;
      display: block;
    }

    .card.pastel {
      background: var(--accent-violet);
      border: 1px solid #ddd0ff;
    }

    .centered {
      justify-content: center;
    }

    .centered .card-body {
      text-align: center;
    }

    .banner-wrapper {
      width: 100%;
      max-width: var(--banner-max-width);
      margin-left: auto;
      margin-right: auto;
      aspect-ratio: 4032 / 3024;
      overflow: hidden;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(74, 43, 51, 0.10);
      background: none;
    }

    .banner-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
    }

    .about {
      background: rgba(255, 247, 251, 0.95);
      border: 1px solid rgba(255, 230, 240, 0.9);
      padding: 1.25rem;
      border-radius: 8px;
      max-width: 900px;
      margin: 0 auto;
    }

    .section-heading {
      margin-top: 1.5rem;
      margin-bottom: .75rem;
      text-align: center;
      font-weight: 700;
    }

    .my-4 {
      margin-top: 1.5rem !important;
      margin-bottom: 1.5rem !important;
    }
  </style>
</head>

<body>
  <div class="container py-4">
    <div class="hero">
      <h1>Welcome to the world of cats! ♡</h1>
      <div class="subtitle">Cat Gallery</div>
    </div>
    <!-- Banner picture -->
    <div class="my-3">
      <div class="banner-wrapper">
        <img src="assets/top-pic.jpg" alt="Cat banner" loading="lazy"
          onerror="this.onerror=null;this.src='https://placekitten.com/4032/3024'">
      </div>
    </div>
    <!-- About Us -->
    <h2 class="section-heading">About Us</h2>
    <div class="about">
      <p>
        Hello! Meet my 12 beloved cats featured in this gallery. I love them deeply, and I’m willing to do anything for
        them. They are sweet, playful, and always there to comfort me whenever I’m tired. This space is dedicated to
        celebrating their joy, warmth, and the happiness they bring into my life.
      </p>
    </div>
    <div id="status">Loading cats...</div>
    <div id="content" class="row"></div>
  </div>
  <script src="cats.js"></script>

  <script>
    // Configuration
    const PLACEHOLDER_IMG = 'https://placekitten.com/400/240';

    /**
     * Normalizes image paths.
     * Handles casing issues and ensures 'assets/' prefix exists only once.
     */
    const getImgSrc = (img) => {
      if (!img) return '';
      const path = String(img).trim();

      // Return immediately if it's an external link, data URL, or absolute path
      if (/^(https?:\/\/|data:|\/)/i.test(path)) return path;

      // Clean up ./ or / prefixes and existing 'assets' text to start fresh
      const cleanName = path.replace(/^[./]+/, '').replace(/^assets\//i, '');

      return encodeURI(`assets/${cleanName}`);
    };

    /**
     * Formats a YYYY-MM-DD string into a readable date.
     */
    const formatDate = (dateStr) => {
      const date = new Date(dateStr);
      if (!dateStr || isNaN(date)) return "Unknown";
      return date.toLocaleDateString('en-US', { year: "numeric", month: "short", day: "numeric" });
    };

    /**
     * Determines if a group's cards should be centered based on the group title.
     */
    const isCenteredGroup = (groupName) => {
      const name = (groupName || '').toLowerCase();
      const centerKeywords = ['my cats', 'my angels', 'far-away baby', 'far-way'];
      return centerKeywords.some(keyword => name.includes(keyword));
    };

    /**
     * Generates HTML for a single cat card.
     */
    const createCatCard = (cat) => {
      const { name, description, birthdate, img } = cat;
      const safeName = (name || '').replace(/"/g, '');
      const imageSrc = getImgSrc(img) || PLACEHOLDER_IMG;

      return `
    <div class="col-6 col-md-4 col-lg-4 d-flex">
      <div class="card pastel shadow my-3 w-100">
        <img src="${imageSrc}" 
             class="card-img-top" 
             alt="${safeName}"
             loading="lazy"
             onerror="this.onerror=null;this.src='${PLACEHOLDER_IMG}'">
        <div class="card-body">
          <h5 class="card-title mb-1">${name || 'Unknown Cat'}</h5>
          <p class="card-text small mb-1">${description || ''}</p>
          <p class="card-text"><small class="text-muted">Born: ${formatDate(birthdate)}</small></p>
        </div>
      </div>
    </div>
  `;
    };

    /**
     * Main function to render the gallery.
     */
    const renderGallery = () => {
      const statusEl = document.getElementById('status');
      const contentEl = document.getElementById('content');

      // 1. Validation
      if (typeof catsData === 'undefined' || !Array.isArray(catsData) || !catsData.length) {
        statusEl.textContent = 'No cats found in data source.';
        return;
      }

      // 2. Clear Loading Status
      statusEl.textContent = '';

      // 3. Build HTML
      contentEl.innerHTML = catsData.map(group => {
        const groupName = group.group || 'Untitled Group';
        const rowClass = isCenteredGroup(groupName) ? 'row centered' : 'row';
        const membersHtml = (group.members || []).map(createCatCard).join('');

        return `
      <div class="col-12 my-4">
        <h3 class="text-center fw-bold mb-3">${groupName}</h3>
        <div class="${rowClass}">
          ${membersHtml}
        </div>
      </div>
    `;
      }).join('');
    };

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', renderGallery);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>